# 2단계 (중간 모델) - 요구사항 설계

## 개요

2단계는 1단계 MVP의 성공을 바탕으로 스마트한 추천 기능과 초기 수익 모델을 구축하는 단계입니다. 백엔드 서버와 데이터베이스를 도입하여 더 정교한 서비스를 제공합니다.

## 1단계에서의 전환 조건

다음 조건을 만족하면 2단계로 전환:
- 일일 활성 사용자 100명 이상
- 사용자 피드백에서 "더 정확한 추천" 요구
- 수익화 필요성 대두

## 핵심 요구사항

### 2.1 컨텍스트 기반 추천

**목표**: 날씨, 시간대, 사용자 컨디션을 고려한 맞춤형 추천

**기능**:
- 사용자 위치 정보 수집 (권한 요청)
- 현재 날씨 정보 가져오기
- 날씨에 따른 메뉴 가중치 조정
  - 5도 이하: 따뜻한 음식 +30%
  - 28도 이상: 시원한 음식 +30%
- 시간대별 추천
  - 06:00-10:00: 아침 메뉴
  - 11:00-14:00: 점심 메뉴
  - 17:00-21:00: 저녁 메뉴

**데이터 요구사항**:
- 메뉴에 온도 속성 추가 (is_warm, is_cold)
- 메뉴에 시간대 태그 추가
- 날씨 API 연동 (OpenWeather)

### 2.2 사용자 선호도 입력

**목표**: 사용자의 현재 상태를 반영한 추천

**기능**:
- 컨디션 선택 UI
  - 피곤함 / 활기참
  - 배고픔 정도 (조금 / 보통 / 매우)
  - 기분 (상쾌 / 우울 / 스트레스)
- 선호도 기반 가중치
  - 피곤함 → 가벼운 메뉴 +20%
  - 매우 배고픔 → 양 많은 메뉴 +30%
- 선택 사항으로 유지 (빠른 추천도 가능)

**데이터 요구사항**:
- 메뉴에 무게 속성 추가 (is_heavy, is_light)
- 메뉴에 기분 태그 추가

### 2.3 광고 시스템 통합

**목표**: 초기 수익 모델 구축

**기능**:
- Google AdSense 통합
- 광고 위치
  - 메인 화면 하단: 배너 광고 1개
  - 추천 결과 하단: 배너 광고 1개
- 광고 로딩 실패 시 graceful degradation
- 광고와 콘텐츠 명확히 구분

**제약사항**:
- 광고가 핵심 기능을 방해하지 않음
- 모바일에서도 적절한 크기
- 페이지 로딩 속도 영향 최소화

### 2.4 추천 히스토리 (서버 저장)

**목표**: 여러 기기에서 히스토리 동기화

**기능**:
- 세션 ID 기반 히스토리 저장
- 서버에 히스토리 저장
- 최근 10개 히스토리 조회
- 히스토리 항목 삭제
- 날짜/시간 표시
- 날씨 정보 함께 저장

**데이터 요구사항**:
- recommendation_history 테이블
- 세션 ID 생성 및 관리
- 타임스탬프, 날씨 정보 저장

## 비기능 요구사항

### 성능
- API 응답 시간 < 500ms
- 페이지 로딩 시간 < 3초
- 날씨 API 캐싱 (10분)

### 확장성
- 동시 사용자 1000명 지원
- 데이터베이스 확장 가능

### 가용성
- 서비스 가동률 99% 이상
- 외부 API 실패 시 대체 로직

### 보안
- HTTPS 통신
- API Rate Limiting
- 입력 검증

## 제외 사항 (2단계에서는 구현 안 함)

- 사용자 계정/로그인
- 가게 정보
- 예약/주문 기능
- 리뷰 시스템
- 결제 기능

## 성공 지표

### 사용자 지표
- 일일 활성 사용자 500명 이상
- 평균 세션 시간 2분 이상
- 재방문율 30% 이상

### 기술 지표
- API 응답 시간 < 500ms
- 에러율 < 1%
- 서버 가동률 99% 이상

### 수익 지표
- 광고 노출 수 1000회/일 이상
- 광고 클릭률 1% 이상
- 월 광고 수익 $10 이상

## 사용자 시나리오

### 시나리오 1: 날씨 기반 추천
1. 사용자가 웹사이트 접속
2. 위치 권한 허용
3. 시스템이 현재 날씨 확인 (영하 5도)
4. "추천받기" 클릭
5. 따뜻한 국물 요리 추천 (김치찌개)
6. "날씨가 추워서 따뜻한 메뉴를 추천했어요" 메시지

### 시나리오 2: 컨디션 기반 추천
1. 사용자가 "매우 배고픔" 선택
2. "추천받기" 클릭
3. 양이 많은 메뉴 추천 (삼겹살 정식)
4. 히스토리에 저장

### 시나리오 3: 광고 노출
1. 메인 화면에서 하단 광고 표시
2. 추천 결과 확인
3. 결과 하단에 광고 표시
4. 광고 클릭 시 수익 발생

## 데이터 모델 확장

### 메뉴 데이터 (확장)
```javascript
{
  id: number,
  name: string,
  category: string,
  tags: string[],
  description: string,
  // 2단계 추가 필드
  is_warm: boolean,      // 따뜻한 음식
  is_cold: boolean,      // 시원한 음식
  is_heavy: boolean,     // 양이 많은
  is_light: boolean,     // 가벼운
  time_tags: string[],   // ["아침", "점심", "저녁"]
  mood_tags: string[]    // ["상쾌", "위로", "활력"]
}
```

### 히스토리 데이터
```javascript
{
  id: number,
  session_id: string,
  menu_id: number,
  recommended_at: timestamp,
  weather_temp: number,
  weather_condition: string,
  user_condition: object
}
```

## 기술적 제약사항

### 무료 티어 한도
- Supabase: 500MB 데이터, 2GB 전송/월
- OpenWeather: 1000 calls/일
- Vercel: 100GB 대역폭/월
- Render: 750시간/월 (무료)

### 대응 방안
- 날씨 API 캐싱으로 호출 수 절약
- 이미지 최적화로 대역폭 절약
- 효율적인 쿼리로 DB 부하 감소

## 다음 단계로의 전환 조건

3단계로 전환 시점:
- 일일 활성 사용자 1000명 이상
- 월 광고 수익 $50 이상
- 가게 제휴 요청 발생
- 사용자 계정 요구 증가
